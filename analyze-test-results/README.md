# Demo: ğŸ§ª Analyze and Fix Failed Unit Tests

Running automated tests and understanding the results is a crucial part of the software development process. 
In this demo, we will show how PR Pilot can analyze the results of failed unit tests and suggest fixes to make the tests pass.

## How it works 
Running [run.sh](./run.sh), PR Pilot will:
1. ğŸ“ Render the template [analyze-test-results.md.jinja2](./analyze-test-results.md.jinja2)
2. ğŸ§ª Execute the shell command `python3 test_fibonacci.py` to run the test script and use the output as part of the prompt
3. ğŸ” Analyze the test results, read the relevant code and suggest fixes to make the tests pass


## Example Output

Running the test analysis script in `analyze-test-results/`:

```bash
âœ  analyze-test-results git:(main) âœ— ./run.sh                   
âŒ  Running shell command: python3 test_fibonacci.py (0:00:00.08)
âœ” Task created: faa27da3-5c0e-4bd0-98e7-a18c431b04d5 (0:00:00.00)
âœ” Analyze and Fix Failed Unit Tests in test_fibonacci.py (0:00:13.55)
â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Result â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚                                                                                                    Analysis of Test Failures                                                                                                    â”‚
â”‚                                                                                                                                                                                                                                 â”‚
â”‚                                                                                                          Failed Tests                                                                                                           â”‚
â”‚                                                                                                                                                                                                                                 â”‚
â”‚  1 test_fibonacci_raises_error_for_negative_n                                                                                                                                                                                   â”‚
â”‚     â€¢ Error: Expected ValueError not raised.                                                                                                                                                                                    â”‚
â”‚     â€¢ Code Snippet:                                                                                                                                                                                                             â”‚
â”‚                                                                                                                                                                                                                                 â”‚
â”‚        def test_fibonacci_raises_error_for_negative_n(self):                                                                                                                                                                    â”‚
â”‚            with self.assertRaises(ValueError):                                                                                                                                                                                  â”‚
â”‚                fibonacci(-1)                                                                                                                                                                                                    â”‚
â”‚                                                                                                                                                                                                                                 â”‚
â”‚  2 test_fibonacci_returns_correct_value_for_positive_n                                                                                                                                                                          â”‚
â”‚     â€¢ Error: Expected fibonacci(10) to be 55, but got -2310.                                                                                                                                                                    â”‚
â”‚     â€¢ Code Snippet:                                                                                                                                                                                                             â”‚
â”‚                                                                                                                                                                                                                                 â”‚
â”‚        def test_fibonacci_returns_correct_value_for_positive_n(self):                                                                                                                                                           â”‚
â”‚            self.assertEqual(fibonacci(10), 55)                                                                                                                                                                                  â”‚
â”‚                                                                                                                                                                                                                                 â”‚
â”‚  3 test_fibonacci_returns_one_when_n_is_one                                                                                                                                                                                     â”‚
â”‚     â€¢ Error: Expected fibonacci(1) to be 1, but got -42.                                                                                                                                                                        â”‚
â”‚     â€¢ Code Snippet:                                                                                                                                                                                                             â”‚
â”‚                                                                                                                                                                                                                                 â”‚
â”‚        def test_fibonacci_returns_one_when_n_is_one(self):                                                                                                                                                                      â”‚
â”‚            self.assertEqual(fibonacci(1), 1)                                                                                                                                                                                    â”‚
â”‚                                                                                                                                                                                                                                 â”‚
â”‚                                                                                                                                                                                                                                 â”‚
â”‚                                                                                                        Cause of Failures                                                                                                        â”‚
â”‚                                                                                                                                                                                                                                 â”‚
â”‚ The fibonacci function implementation in analyze-test-results/test_fibonacci.py has the following issues:                                                                                                                       â”‚
â”‚                                                                                                                                                                                                                                 â”‚
â”‚  1 Negative Input Handling: The function does not raise a ValueError for negative inputs.                                                                                                                                       â”‚
â”‚  2 Incorrect Base Case for n == 1: The function returns -42 instead of 1.                                                                                                                                                       â”‚
â”‚  3 Recursive Case: The function's recursive implementation is incorrect, leading to wrong results for positive n.                                                                                                               â”‚
â”‚                                                                                                                                                                                                                                 â”‚
â”‚                                                                                                         Suggested Fixes                                                                                                         â”‚
â”‚                                                                                                                                                                                                                                 â”‚
â”‚  1 Raise ValueError for Negative Inputs:                                                                                                                                                                                        â”‚
â”‚                                                                                                                                                                                                                                 â”‚
â”‚     if n < 0:                                                                                                                                                                                                                   â”‚
â”‚         raise ValueError("Input should be a non-negative integer")                                                                                                                                                              â”‚
â”‚                                                                                                                                                                                                                                 â”‚
â”‚  2 Correct Base Case for n == 1:                                                                                                                                                                                                â”‚
â”‚                                                                                                                                                                                                                                 â”‚
â”‚     elif n == 1:                                                                                                                                                                                                                â”‚
â”‚         return 1                                                                                                                                                                                                                â”‚
â”‚                                                                                                                                                                                                                                 â”‚
â”‚  3 Fix Recursive Case:                                                                                                                                                                                                          â”‚
â”‚                                                                                                                                                                                                                                 â”‚
â”‚     else:                                                                                                                                                                                                                       â”‚
â”‚         return fibonacci(n - 1) + fibonacci(n - 2)                                                                                                                                                                              â”‚
â”‚                                                                                                                                                                                                                                 â”‚
â”‚                                                                                                                                                                                                                                 â”‚
â”‚                                                                                                   Updated fibonacci Function                                                                                                    â”‚
â”‚                                                                                                                                                                                                                                 â”‚
â”‚ Here is the corrected fibonacci function:                                                                                                                                                                                       â”‚
â”‚                                                                                                                                                                                                                                 â”‚
â”‚                                                                                                                                                                                                                                 â”‚
â”‚  def fibonacci(n):                                                                                                                                                                                                              â”‚
â”‚      """Calculate the Fibonacci number of n"""                                                                                                                                                                                  â”‚
â”‚      if n < 0:                                                                                                                                                                                                                  â”‚
â”‚          raise ValueError("Input should be a non-negative integer")                                                                                                                                                             â”‚
â”‚      elif n == 0:                                                                                                                                                                                                               â”‚
â”‚          return 0                                                                                                                                                                                                               â”‚
â”‚      elif n == 1:                                                                                                                                                                                                               â”‚
â”‚          return 1                                                                                                                                                                                                               â”‚
â”‚      else:                                                                                                                                                                                                                      â”‚
â”‚          return fibonacci(n - 1) + fibonacci(n - 2)                                                                                                                                                                             â”‚
â”‚                                                                                                                                                                                                                                 â”‚
â”‚                                                                                                                                                                                                                                 â”‚
â”‚ By applying these changes, the tests should pass successfully.                                                                                                                                                                  â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
```